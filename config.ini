# config.ini
[STRATEGY]
# Pine Scriptä¸­çš„å‚æ•°
bb_length = 365
bb_mult = 2.0
ema_fast_length = 30
ema_slow_length = 90
trend_timeframe = 4h # è¶‹åŠ¿è¿‡æ»¤å‘¨æœŸ (m for minutes, h for hours, d for day)

[MARKETS]
# æŒ‡å‘ä½ çš„è‚¡ç¥¨åˆ—è¡¨æ–‡ä»¶
us_stocks_path = stock_lists/us_stocks.txt
hk_stocks_path = stock_lists/hk_stocks.txt
cn_stocks_path = stock_lists/cn_stocks.txt```
crypto_symbols_path = stock_lists/crypto_symbols.txt # <-- æ–°å¢
[CRYPTO_SETTINGS] # <-- æ–°å¢
# å¸å®‰APIåªæ¥å—ç‰¹å®šçš„æ—¶é—´å‘¨æœŸå­—ç¬¦ä¸²
trend_timeframe_crypto = 4h # è¶‹åŠ¿è¿‡æ»¤å‘¨æœŸ (1m, 5m, 1h, 4h, 1d)
#### **4. å‡†å¤‡è‚¡ç¥¨åˆ—è¡¨**

åœ¨ `stock_lists/` æ–‡ä»¶å¤¹ä¸‹ï¼Œåˆ›å»ºå¯¹åº”çš„ `.txt` æ–‡ä»¶ï¼Œæ¯è¡Œæ”¾ä¸€ä¸ªè‚¡ç¥¨ä»£ç ã€‚

*   **`us_stocks.txt`**: `AAPL`, `GOOGL`, `MSFT` ...
*   **`hk_stocks.txt`**: `0700.HK`, `9988.HK` ... (æ¸¯è‚¡ä»£ç åœ¨yfinanceä¸­éœ€è¦`.HK`åç¼€)
*   **`cn_stocks.txt`**: `600519.SH`, `000001.SZ` ... (Aè‚¡ä»£ç åœ¨Tushareä¸­éœ€è¦`.SH`æˆ–`.SZ`åç¼€)
*   **`crypto_symbols.txt`**: è¿™é‡Œè¾“å…¥çš„äº¤æ˜“å¯¹å¿…é¡»æ˜¯å¸å®‰APIæ¥å—çš„æ ¼å¼ï¼ˆä¾‹å¦‚ BTCUSDT, ETHUSDTï¼‰
---

### **ç¬¬äºŒé˜¶æ®µï¼šç¼–å†™æ ¸å¿ƒä»£ç æ¨¡å—**

ç°åœ¨æˆ‘ä»¬æ¥å¡«å……æ¯ä¸ª `.py` æ–‡ä»¶çš„å†…å®¹ã€‚

#### **1. æ•°æ®è·å–å™¨ (`data_fetcher.py`)**

è¿™ä¸ªæ¨¡å—è´Ÿè´£ä»ä¸åŒæ¥æºè·å–æ•°æ®ï¼Œå¹¶å¤„ç†å¤šæ—¶é—´å‘¨æœŸï¼ˆMTFï¼‰çš„é—®é¢˜ã€‚

```python
# data_fetcher.py
import yfinance as yf
import tushare as ts
import pandas as pd
import os
import requests


def get_binance_data(symbol, interval='1d', limit=500):
    """
    ä½¿ç”¨Binance APIè·å–åŠ å¯†è´§å¸Kçº¿æ•°æ®ã€‚
    è¿”å›ä¸yfinanceæ ¼å¼å…¼å®¹çš„DataFrameã€‚
    """
    url = f"https://api.binance.com/api/v3/klines?symbol={symbol}&interval={interval}&limit={limit}"
    try:
        response = requests.get(url)
        response.raise_for_status()
        data = response.json()
        
        # è½¬æ¢æ•°æ®ä¸ºPandas DataFrame
        df = pd.DataFrame(data, columns=[
            'timestamp', 'open', 'high', 'low', 'close', 'volume', 
            'close_time', 'quote_asset_volume', 'number_of_trades', 
            'taker_buy_base_asset_volume', 'taker_buy_quote_asset_volume', 'ignore'
        ])
        
        # --- å…³é”®ï¼šæ ¼å¼åŒ–DataFrameä»¥åŒ¹é…yfinanceçš„è¾“å‡º ---
        df = df[['timestamp', 'open', 'high', 'low', 'close', 'volume']].astype(float)
        df['date'] = pd.to_datetime(df['timestamp'], unit='ms')
        df.set_index('date', inplace=True)
        df.drop('timestamp', axis=1, inplace=True)
        # å¸å®‰APIè¿”å›çš„æ—¥çº¿æ•°æ®æ—¶é—´æ˜¯å½“å¤©çš„å¼€å§‹ï¼Œyfinanceæ˜¯å½“å¤©çš„ç»“æŸï¼Œä¸ºäº†ç»Ÿä¸€ï¼Œæˆ‘ä»¬ä¿æŒåŸæ ·
        
        return df

    except requests.RequestException as e:
        print(f"ğŸ”¥ Error fetching {symbol} from Binance: {e}")
        return pd.DataFrame() # è¿”å›ç©ºçš„DataFrame
        
# åˆå§‹åŒ–Tushare
pro = ts.pro_api(os.getenv('TUSHARE_TOKEN'))

def get_yfinance_data(ticker, period="1y", interval="1d"):
    """ä½¿ç”¨yfinanceè·å–ç¾è‚¡/æ¸¯è‚¡æ•°æ®"""
    stock = yf.Ticker(ticker)
    df = stock.history(period=period, interval=interval)
    # yfinanceåˆ—åä¸ºå¤§å†™ï¼Œç»Ÿä¸€ä¸ºå°å†™
    df.columns = [col.lower() for col in df.columns]
    return df

def get_tushare_data(ticker, start_date, end_date):
    """ä½¿ç”¨Tushareè·å–Aè‚¡æ•°æ®"""
    # Tushareçš„æ—¥æœŸæ ¼å¼æ˜¯YYYYMMDD
    df = pro.daily(ts_code=ticker, start_date=start_date, end_date=end_date)
    # Tushareè¿”å›çš„æ•°æ®æ˜¯å€’åºçš„ï¼Œéœ€è¦åè½¬
    df = df.sort_values(by='trade_date', ascending=True)
    # é‡å‘½ååˆ—ä»¥åŒ¹é…yfinance
    df = df.rename(columns={'trade_date': 'date', 'vol': 'volume'})
    df['date'] = pd.to_datetime(df['date'])
    df.set_index('date', inplace=True)
    return df
